{{- $ctx := . }}
{{- if .IsHome }}{{ $ctx = .Site }}{{ end }}
{{- $pages := slice }}
{{- if or $.IsHome $.IsSection }}
{{- $pages = $ctx.RegularPages }}
{{- else }}
{{- $pages = $ctx.Pages }}
{{- end }}
{{- $limit := .Site.Config.Services.RSS.Limit }}
{{- if ge $limit 1 }}
{{- $pages = $pages | first $limit }}
{{- end }}

{{- range $pages }}
<item>
  <title>{{ .Title }}</title>
  <link>{{ .Permalink }}</link>
  <pubDate>{{ .PublishDate.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</pubDate>
  <author>{{ default site.Params.author.name .Params.author }}</author>
  <guid>{{ .Permalink }}</guid>
  {{- range .Params.categories }}
  <category>{{ . }}</category>
  {{- end}}
  <description>{{ .Content | transform.XMLEscape | safeHTML }}</description>
</item>
{{- end }}

